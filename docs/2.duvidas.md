# Dúvidas

## Sumário

1. [Estrutura da aplicação: qual a melhor abordagem?](#estrutura-da-aplicação-qual-a-melhor-abordagem)
2. [JWT vs Session ID?](#jwt-vs-session-id)
3. [Se eu fosse de NextJs com BFF separado](#se-eu-fose-de-nextjs-com-bff-separado)
   - [Como faria a questão do banco de dados?](#como-faria-a-questao-do-banco-de-dados)
   - [Infra](#infra)
4. [Se eu fosse de backend python + frontend Vite](#se-eu-fosse-de-backend-python--frontend-vite)
   - [Como seria o auth?](#como-seria-o-auth)
   - [Infra](#infra-1)
   - [Outras questões relevantes](#outras-questões-relevantes)
5. [Domínios](#domínios)
6. [O que o mercado adota mais hoje em dia pra casos similares ao nosso?](#o-que-o-mercado-adota-mais-hoje-em-dia-pra-casos-similares-ao-nosso)
7. [Veredicto](#veredicto)
   - [Dado nosso contexto, qual abordagem vc recomendaria?](#dado-nosso-contexto-qual-abordagem-vc-recomendaria)
   - [Como seriam os exemplos de codigo para as principais partes da abordagem escolhida?](#como-seriam-os-exemplos-de-codigo-para-as-principais-partes-da-abordagem-escolhida)

---

## Estrutura da aplicação: qual a melhor abordagem?

1. backend ("bff" + api) em python em 1 CloudRun só e frontend em Vite
2. api em python em CRun privado, e outro CRun (publico) com Nextjs fazendo BFF (pra cuidar de auth (google oauth2, email/senha etc)) bem cm o frontend.

## JWT vs Session ID?

A priori, independente de ser NextJs ou python+Vite, algumas dúvidas:

a) PAra meu caso, vc recomendaria JWT puro stateless ou Session ID? ou um hibrido?

OBS: Em qq caso, quero usar cookie HttpOnly, mais seguro (evita XSS, por ex,certo?).

b) se for usar um statless mas tiver que fazer puxadinho em Redis/DB (blacklist etc), ai nao faria mais sentido usar Session ID logo?

c) a depender da abordagem, usaria-se refresh tokens ou algum refrsh process?

d) se for ter postgres/redis no processo de auth
- quem é o dono? (orm, schema)
- quem le?


## Se eu fose de NextJs com BFF separado

### Como faria a questao do banco/redis na auth?

Só por curiosidade, suponha q eu fosse de NextJs com o BFF dele concentrando a parte do OAuth2 google ou email msm.

Ouvi dizer q haveria 2 abordagens possiveis:

a) bff enxerga banco e escreve o q for necessario la (user, user_identities, sessions etc)

Alem disso, 2 subpossibildades aqui:

a.1) o bff poderia mexer em schema (prisma etc)

a.2) o esquema so seria mexido pelo lado python (alchemy), d forma q bff so escrevesse em tabelas mediante contrato bem definido entre as "moving partes" (api e bff)

b) bff NAO enxergaria banco: pra email/senha, validaria no python (q conhece users no banco) e geraria e gerwnciaria jwt, cookie etc. Pra oauth2 (google),


Dito isso, qual sua recomendacao supondo q fossemos usar nextjs pra bff+front?

Ou, na verdade, haveria uma terceira possibilidade q vc consideraria melhor?

### Informacoes trocadas entre BFF e API

1) o bff mandaria token/jwt/session id pro python em cada request (pra api validar e saber quem é o user)? ou o bff faria o auth mandaria pro python so o user_id (ou outro identificador)? (estilo "Trusted Subsystem")

### Infra

a) 2 CRun (1 api, 1 bff+front)?

b) precisaria de algo mais complexo (load balancer etc)?

c) em qq caso, como é o custo?


## Se eu fosse de backend python + frontend Vite

### Como seria o auth?

1) email/senha?
2) google oauth2?

### Infra

a) 1 CRun só (api + bff) com o frontend em Vite separado (GCS? Precisaria load balancer?)?

b) 2 CRun (1 api, 1 bff)?

3) em qq caso, como é o custo?

### Outras questões relevantes

1) CORS?
2) Segurança?
3) O que eu estaria perdendo em relação a não fazer o BFF em NextJs? 

## Domínios

1) app.pilotodevendas.com.br (frontend vite) e api.pilotodevendas.com.br (backend python)?
2) tudo em app.pilotodevendas.com.br (com api em /api/*)?
3) outra abordagem?

## O que o mercado adota mais hoje em dia pra casos similares ao nosso?

a) Hoje em dia, pensando em apps similares a minha (plataformas para gerenciamento e operacao de agentes para converaar wm Whatsapp ou Instagram), é mais comum usar o lado "api" (independente de estar junto com o lado bff) em python ou node/TS?

b) E, mais especificamente, o lado core da api (lidar com llm, rag, persistir mensagens etc), seria em python ou node/ts? Pergunto pq uso Langchain e vejo q ele tem as 2 vertentes

## Veredicto

MAPEAR ISSO EM `@docs/3.decisoes.md`

### Dado nosso contexto, qual abordagem vc recomendaria?

??

### Como seriam os exemplos de codigo para as principais partes da abordagem escolhida?

??


## Curiosidade

Agora, independente das limitações do meu contexto, qual que seria realmente a boa prática que você recomendaria? Claro, tendo em mente uma valorização de simplicidade dentro da arquitetura proposta. 